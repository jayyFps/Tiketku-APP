<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TiketKu - Platform Event Modern</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="nav-glass">
      <div class="logo">âœ¨ TiketKu</div>
      <ul class="nav-links" id="navLinks">
        <li><a href="/" class="nav-link">Home</a></li>
        <li><a href="/events.html" class="nav-link">Explore</a></li>
        <li id="myTicketsLink" class="hidden"><a href="/my-tickets.html" class="nav-link">My Tickets</a></li>

        <!-- Auth Buttons -->
        <li id="loginLink"><a href="#" onclick="openModal('loginModal')" class="btn btn-ghost">Sign In</a></li>
        <li id="registerLink"><a href="#" onclick="openModal('registerModal')" class="btn btn-primary"
            style="padding: 0.5rem 1.5rem;">Join Free</a></li>

        <li id="userInfo" class="hidden flex items-center gap-2">
          <span id="username" style="font-weight:600; color:var(--primary); margin-right:10px;"></span>
          <a href="#" onclick="logout()" class="btn btn-ghost"
            style="padding: 0.5rem 1rem; font-size: 0.8rem;">Logout</a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero container">
    <div class="hero-content">
      <span class="hero-tag">ğŸš€ Platform Tiket Masa Depan</span>
      <h1>Temukan Event Seru & Kembangkan Skill Baru</h1>
      <p>Jelajahi ribuan konser, seminar, dan workshop menarik. Beli tiket dengan mudah, cepat, dan aman.</p>

      <!-- Search Pill -->
      <form action="/events.html" method="GET" class="search-pill">
        <input type="text" name="search" class="search-input" placeholder="Cari event, artis, atau lokasi...">
        <button type="submit" class="search-btn">Cari</button>
      </form>
    </div>

    <!-- 3D Illustration -->
    <div class="hero-image-container">
      <img src="/images/hero.png" alt="Event Celebration" class="hero-image"
        onerror="this.src='https://cdni.iconscout.com/illustration/premium/thumb/people-celebrating-near-confetti-giant-smartphone-screen-2975815-2476891.png'">
    </div>
  </section>

  <!-- Featured Section -->
  <section class="container">
    <div class="section-title">
      <h2>Event Populer Minggu Ini ğŸ”¥</h2>
      <p>Jangan sampai kehabisan tiket event favoritmu</p>
    </div>

    <div class="grid" id="featuredEvents">
      <div class="loading-container" style="text-align:center; grid-column:1/-1;">
        <div class="spinner"></div>
      </div>
    </div>
  </section>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
        <h3>Welcome Back ğŸ‘‹</h3>
        <button onclick="closeModal('loginModal')"
          style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
      </div>
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Username</label>
          <input type="text" class="form-input" id="loginUsername" required>
        </div>
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Password</label>
          <input type="password" class="form-input" id="loginPassword" required>
        </div>
        <div id="loginError" class="alert alert-error hidden" style="color:red; margin-bottom:1rem; font-size:0.9rem;">
        </div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Sign In</button>
      </form>
      <p style="text-align:center; margin-top:1rem; font-size:0.9rem; color:var(--text-light);">
        Belum punya akun? <a href="#" onclick="closeModal('loginModal'); openModal('registerModal')"
          style="color:var(--primary); font-weight:600;">Daftar disini</a>
      </p>
    </div>
  </div>

  <!-- Register Modal -->
  <div id="registerModal" class="modal">
    <div class="modal-content">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1.5rem;">
        <h3>Create Account ğŸš€</h3>
        <button onclick="closeModal('registerModal')"
          style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
      </div>
      <form id="registerForm" onsubmit="handleRegister(event)">
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Username</label>
          <input type="text" class="form-input" id="registerUsername" required>
        </div>
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Email</label>
          <input type="email" class="form-input" id="registerEmail" required>
        </div>
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Password</label>
          <input type="password" class="form-input" id="registerPassword" required minlength="6">
        </div>
        <div>
          <label style="font-weight:600; font-size:0.9rem;">Daftar Sebagai</label>
          <select class="form-select" id="registerRole" required>
            <option value="user">User (Pembeli Tiket)</option>
            <option value="admin">Admin (Pengelola Event)</option>
          </select>
        </div>
        <div id="registerError" class="alert alert-error hidden"
          style="color:red; margin-bottom:1rem; font-size:0.9rem;"></div>
        <div id="registerSuccess" class="alert alert-success hidden"
          style="color:green; margin-bottom:1rem; font-size:0.9rem;"></div>
        <button type="submit" class="btn btn-primary" style="width: 100%;">Create Account</button>
      </form>
      <p style="text-align:center; margin-top:1rem; font-size:0.9rem; color:var(--text-light);">
        Sudah punya akun? <a href="#" onclick="closeModal('registerModal'); openModal('loginModal')"
          style="color:var(--primary); font-weight:600;">Login</a>
      </p>
    </div>
  </div>

  <script src="/js/app.js"></script>
  <script>
    // Frontend Logic
    window.addEventListener('DOMContentLoaded', async () => {
      updateNavigation();
      await loadFeaturedEvents();

      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('showLogin') === 'true') {
        openModal('loginModal');
        window.history.replaceState({}, document.title, '/');
      }
    });

    async function loadFeaturedEvents() {
      try {
        const response = await fetch('/api/events');
        const data = await response.json();
        const eventsContainer = document.getElementById('featuredEvents');

        if (data.events && data.events.length > 0) {
          const featured = data.events.slice(0, 6);
          eventsContainer.innerHTML = featured.map(event => createEventCard(event)).join('');
        } else {
          eventsContainer.innerHTML = '<p style="text-align:center; grid-column:1/-1;">Belum ada event tersedia.</p>';
        }
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('featuredEvents').innerHTML = '<p style="text-align:center; grid-column:1/-1;">Gagal memuat event.</p>';
      }
    }

    function createEventCard(event) {
      // Stock logic
      const stockText = event.stock > 0 ? `${event.stock} seat left` : 'Sold Out';
      const stockColor = event.stock > 0 ? '#10b981' : '#ef4444';

      return `
        <div class="card">
            <div class="card-img-wrap">
                <img src="${event.image_url}" alt="${event.name}" class="card-img" onerror="this.src='https://via.placeholder.com/400x200?text=Event'">
                <div style="position:absolute; top:10px; right:10px; background:white; padding:4px 12px; border-radius:12px; font-size:0.8rem; font-weight:600; color:${stockColor}">
                    ${stockText}
                </div>
            </div>
            <div class="card-content">
                <div class="card-info">
                    <span>ğŸ“… ${new Date(event.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' })}</span>
                    <span>ğŸ“ ${event.location.split(',')[0]}</span>
                </div>
                <h3 class="card-title">${event.name}</h3>
                <span class="card-price">Rp ${new Intl.NumberFormat('id-ID').format(event.price)}</span>
                
                <a href="/event-detail.html?id=${event.id}" class="btn btn-primary" style="width:100%; margin-top:0.5rem;">
                    ${event.stock > 0 ? 'Book Ticket' : 'Details'}
                </a>
            </div>
        </div>
        `;
    }
  </script>
</body>

</html>